from configparser import ConfigParser
import pandas as pd
from bytes2img import bytes2img
import os

#data_path = os.getenv("DATA_PATH")
config = ConfigParser()
config.read("config.ini")
data_path = config.get("project", "DATA_PATH")
extract_path = data_path + "images/"

train = data_path + "train/"
labels = data_path + "trainLabels.csv"

df = pd.read_csv(labels)

os.mkdir(extract_path)
for i in range(1, 10):
    os.mkdir(extract_path + str(i))

print("Creating Malware-Detection Image Dataset")
for ind in df.index:
    file = str(df['Id'][ind])
    cls = str(df['Class'][ind])
    print(file, cls)
    new_path = extract_path + "/" + cls + "/" + file + '.png'
    new_train = train + file + '.bytes'
    im = bytes2img(new_train)
    im.save(new_path, "PNG")

print("Process Finished")
