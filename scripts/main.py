import argparse as ap
import json
import sys
import numpy
import sklearn
import os
from etl.static_features import All_Resources
import uuid
from model import MalwareDetector

if __name__ == "__main__":
    # Add command Line Argument for data_path
    parser = ap.ArgumentParser(description="file")
    parser.add_argument("file", metavar="file", type=str,
                        help="File to predict")

    args = parser.parse_args()
    file = str(args.file)

    file_name = file.split("/")[-1]

    hex_filename = uuid.uuid4().hex

    static_features = All_Resources(file, file_name)
    os.system("hexdump -v  -e '" + '"%08.8_ax  "' + "' -e' 4/1 " + '"%02x " " " 4/1 "%02x " " "  4/1 "%02x " " " 4/1 "%02x "  ' +
              "' -e '" + '"\n"' + "' " + file + " > ../data/bytes/" + hex_filename)
    os.system("objdump -d " + file + " > ../data/asm/" + hex_filename)
    isfile = os.path.exists(file)

    resp = {
        "filepath": file,
        "isfile": isfile,
        "predict": 1
    }
    print(json.dumps(resp))
